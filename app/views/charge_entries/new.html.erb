<% content_for :head do %>
  <%= stylesheet_link_tag "charge", "data-turbo-track": "reload" %>
<% end %>

<div class="charge-wrap" data-controller="receipt">
  <div class="charge-head">
    <h1>💰 Charge 登録</h1>
    <a class="ghost-btn" href="<%= charge_entries_path %>">一覧</a>
  </div>

  <!-- レシート読み取りボタン -->
  <div class="receipt-upload-section">
    <label class="receipt-upload-btn">
      📷 レシート読み取り
      <input type="file"
             accept="image/*"
             capture="environment"
             style="display: none;"
             data-action="change->receipt#scan"
             data-receipt-target="fileInput">
    </label>
    <div data-receipt-target="status" class="receipt-status"></div>
    <div data-receipt-target="preview" class="receipt-preview"></div>
  </div>

  <%= form_with model: @entry, data: { receipt_target: "form" } do |f| %>
    <div class="card">
      <label>区分</label>
      <div class="seg">
        <%= f.radio_button :direction, :incoming, checked: @entry.direction_incoming? || @entry.direction.nil?, data: { receipt_target: "directionIncoming" } %><span>受取</span>
        <%= f.radio_button :direction, :outgoing, checked: @entry.direction_outgoing?, data: { receipt_target: "directionOutgoing" } %><span>支払</span>
      </div>

      <label>金額（円）</label>
      <%= f.number_field :amount_yen, inputmode: "numeric", placeholder: "例: 12000", data: { receipt_target: "amount" } %>

      <label>相手（任意）</label>
      <%= f.text_field :counterparty, placeholder: "例: 田中 / 銀行 / コンビニ", data: { receipt_target: "counterparty" } %>

      <label>カテゴリ</label>
      <%= f.select :category, ["交通費","飲食","立替","雑","その他"], { include_blank: "選択" }, data: { receipt_target: "category" } %>

      <label>メモ（任意）</label>
      <%= f.text_area :note, rows: 3, placeholder: "例: 〇〇の立替 / 返済 / チャージ", data: { receipt_target: "note" } %>

      <button class="horse-primary">記録する</button>
    </div>
  <% end %>
</div>
