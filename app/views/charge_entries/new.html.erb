<% content_for :head do %>
  <%= stylesheet_link_tag "hub", "data-turbo-track": "reload" %>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700;800&family=Sora:wght@600;700;800&display=swap" rel="stylesheet">
<% end %>

<div class="chrg" data-controller="receipt">
  <!-- Header -->
  <header class="chrg-hdr">
    <%= link_to "â†", charge_entries_path, class: "chrg-bk" %>
    <h1 class="chrg-t">New Entry</h1>
  </header>

  <!-- Receipt Scan -->
  <div style="padding: 0 20px 10px;">
    <label class="ci" style="cursor: pointer;">
      <div class="cbb cbb-r" style="font-size: 18px;">ðŸ“·</div>
      <div class="cd">
        <div class="cd-n" style="color: var(--or);">Scan Receipt</div>
        <div class="cd-m">Auto-fill from photo</div>
      </div>
      <input type="file"
             accept="image/*"
             capture="environment"
             style="display: none;"
             data-action="change->receipt#scan"
             data-receipt-target="fileInput">
    </label>
    <div data-receipt-target="status" style="text-align: center; padding: 8px; color: var(--or); font-size: 12px;"></div>
    <div data-receipt-target="preview" style="text-align: center;"></div>
  </div>

  <!-- Form -->
  <div class="form-container">
    <%= form_with model: @entry, data: { receipt_target: "form" } do |f| %>

      <div class="form-group">
        <label class="form-label">Direction</label>
        <div style="display: flex; gap: 10px;">
          <label class="ci" style="flex: 1; padding: 14px; cursor: pointer;">
            <%= f.radio_button :direction, :incoming, checked: @entry.direction_incoming? || @entry.direction.nil?, data: { receipt_target: "directionIncoming" }, style: "display: none;" %>
            <div class="cbb cbb-r">IN</div>
            <span style="flex: 1; color: var(--green);">Received</span>
          </label>
          <label class="ci" style="flex: 1; padding: 14px; cursor: pointer;">
            <%= f.radio_button :direction, :outgoing, checked: @entry.direction_outgoing?, data: { receipt_target: "directionOutgoing" }, style: "display: none;" %>
            <div class="cbb cbb-p">OUT</div>
            <span style="flex: 1; color: var(--red);">Paid</span>
          </label>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Amount (Â¥)</label>
        <%= f.number_field :amount_yen, inputmode: "numeric", placeholder: "12000", class: "form-input", data: { receipt_target: "amount" } %>
      </div>

      <div class="form-group">
        <label class="form-label">Counterparty</label>
        <%= f.text_field :counterparty, placeholder: "Company / Person", class: "form-input", data: { receipt_target: "counterparty" } %>
      </div>

      <div class="form-group">
        <label class="form-label">Category</label>
        <%= f.select :category, ["äº¤é€šè²»", "é£²é£Ÿ", "ç«‹æ›¿", "é›‘", "ãã®ä»–"], { include_blank: "Select..." }, class: "form-input", data: { receipt_target: "category" } %>
      </div>

      <div class="form-group">
        <label class="form-label">Note</label>
        <%= f.text_area :note, rows: 3, placeholder: "Details...", class: "form-input", data: { receipt_target: "note" } %>
      </div>

      <button type="submit" class="form-btn shine-btn">Save Entry</button>
    <% end %>
  </div>
</div>

<style>
  /* Radio button selection styling */
  .ci:has(input[type="radio"]:checked) {
    border-color: var(--or);
    box-shadow: 0 0 0 2px rgba(255, 122, 0, 0.2);
  }
</style>
