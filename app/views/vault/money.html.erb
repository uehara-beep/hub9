<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>Vault / お金メモ</title>
  <%= csrf_meta_tags %>
  <%= stylesheet_link_tag "vault", "data-turbo-track": "reload" %>
</head>
<body class="vault-body">
  <div class="vault-wrap">
    <div class="vault-card vault-card--wide">
      <div class="vault-title">💰 お金メモ</div>
      <div class="vault-sub">チャージ / 立て替え / 送金 / 裏</div>

      <%= form_with model: @entry, url: "/vault/money", method: :post, local: true, class: "money-form" do |f| %>
        <% if @entry.errors.any? %>
          <div class="vault-error">
            <% @entry.errors.full_messages.each do |m| %>
              <div>• <%= m %></div>
            <% end %>
          </div>
        <% end %>

        <div class="money-cats" role="group" aria-label="カテゴリ">
          <button type="button" class="money-cat" data-cat="charge" data-kind="income" data-hidden="false">チャージ</button>
          <button type="button" class="money-cat" data-cat="advance" data-kind="expense" data-hidden="false">立て替え</button>
          <button type="button" class="money-cat" data-cat="transfer" data-kind="expense" data-hidden="false">送金</button>
          <button type="button" class="money-cat money-cat--dark" data-cat="hidden" data-kind="expense" data-hidden="true">裏</button>
        </div>

        <%= f.hidden_field :category, id: "money-category" %>
        <%= f.hidden_field :kind, id: "money-kind" %>
        <%= f.hidden_field :hidden, id: "money-hidden" %>
        <%= f.hidden_field :occurred_on, value: Date.today %>

        <div class="money-row">
          <label class="money-label">金額</label>
          <div class="money-amount">
            <%= f.number_field :amount_yen, inputmode: "numeric", class: "money-input", placeholder: "例）12000" %>
            <div class="money-suffix">円</div>
          </div>
        </div>

        <div class="money-row">
          <label class="money-label">一言</label>
          <%= f.text_field :tag, class: "money-input", placeholder: "例）◯◯へ立替" %>
        </div>

        <div class="money-row">
          <label class="money-label">メモ</label>
          <%= f.text_area :memo, class: "money-textarea", rows: 3, placeholder: "補足（任意）" %>
        </div>

        <div class="money-row">
          <label class="money-label">領収書（写メ）</label>
          <%= f.file_field :receipt, accept: "image/*", capture: "environment", class: "money-file" %>
          <div class="money-hint">※スマホのカメラでそのまま撮影OK</div>
        </div>

        <button class="vault-primary money-submit" type="submit">記録</button>

        <div class="money-danger">
          <a class="money-back" href="/vault/home">← 戻る</a>
        </div>
      <% end %>
    </div>
  </div>

  <script>
  (function(){
    const cats = document.querySelectorAll(".money-cat");
    const cat  = document.getElementById("money-category");
    const kind = document.getElementById("money-kind");
    const hid  = document.getElementById("money-hidden");

    const activate = (btn) => {
      cats.forEach(b => b.classList.remove("is-active"));
      btn.classList.add("is-active");
      cat.value  = btn.dataset.cat || "";
      kind.value = btn.dataset.kind || "";
      hid.value  = btn.dataset.hidden || "false";
    };

    cats.forEach(btn => btn.addEventListener("click", () => activate(btn), {passive:true}));

    if (cats[1]) activate(cats[1]); // default: 立て替え
  })();
  </script>
</body>
</html>
